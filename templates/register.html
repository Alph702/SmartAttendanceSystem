{% extends "base.html" %} {% block content %}
<div style="max-width: 800px; margin: 0 auto">
  <h2
    style="
      margin-bottom: 2rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      padding-bottom: 1rem;
    "
  >
    Register New User
  </h2>

  <div class="glass-panel" style="padding: 2rem">
    <div style="margin-bottom: 2rem">
      <label
        style="display: block; margin-bottom: 0.5rem; color: var(--text-muted)"
        >Full Name</label
      >
      <input type="text" id="username" placeholder="e.g. John Doe" />
    </div>

    <div class="video-container" style="margin-bottom: 2rem">
      <!-- Source will be the Flask video feed route with mode=register -->
      <img
        src="{{ url_for('video_feed', mode='register') }}"
        class="video-feed"
        alt="Video Feed"
      />
    </div>

    <div style="display: flex; gap: 1rem; align-items: center">
      <button id="captureBtn" class="btn btn-primary">
        Capture & Register
      </button>
      <div id="statusArea"></div>
    </div>
  </div>
</div>

<script>
  const captureBtn = document.getElementById("captureBtn");
  const usernameInput = document.getElementById("username");
  const statusArea = document.getElementById("statusArea");

  captureBtn.addEventListener("click", async () => {
    const name = usernameInput.value.trim();
    if (!name) {
      alert("Please enter a name first.");
      return;
    }

    captureBtn.disabled = true;
    captureBtn.innerText = "Processing...";

    try {
      const response = await fetch("/api/register_capture", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name: name }),
      });
      const data = await response.json();

      if (data.success) {
        statusArea.innerHTML = `<span class="status-success" style="display:inline-block; margin:0;">${data.message}</span>`;
        usernameInput.value = "";
      } else {
        statusArea.innerHTML = `<span class="status-error" style="display:inline-block; margin:0;">${data.message}</span>`;
      }
    } catch (e) {
      console.error(e);
      statusArea.innerHTML = `<span class="status-error" style="display:inline-block; margin:0;">Network Error</span>`;
    } finally {
      captureBtn.disabled = false;
      captureBtn.innerText = "Capture & Register";
    }
  });
</script>
{% endblock %}
